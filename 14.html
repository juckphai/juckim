<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ชื่อบัญชี</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f7fb;
      margin: 0;
      padding: 0;
    }

    h2 {
      text-align: center;
      color: #333;
      margin-top: 30px;
      font-size: 28px;
    }

    .container {
      max-width: 800px;
      margin: 20px auto;
      background-color: #ffffff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    label {
      font-weight: bold;
      color: #333;
      font-size: 16px;
      margin-bottom: 5px;
    }

    select,
    input[type="text"],
    input[type="number"],
    input[type="date"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
      background-color: #f9f9f9;
      box-sizing: border-box;
    }

    .back-button,
    .file-button {
      font-size: 16px;
      padding: 10px 20px;
      border-radius: 10px;
      border: none;
      width: 50%;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
      margin: 10px;
    }

    .back-button {
      background-color: #ff5722;
    }

    .back-button:hover {
      background-color: #e64a19;
    }

    .file-button {
      background-color: #007bff;
    }

    .file-button:hover {
      background-color: #0056b3;
    }

    .entry-form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .entry-group {
      display: flex;
      flex-direction: column;
    }
  /* สำหรับ Chrome, Safari, Edge */
  input[type=number]::-webkit-inner-spin-button,
  input[type=number]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  /* สำหรับ Firefox */
  input[type=number] {
    -moz-appearance: textfield;
  }

    .button-group,
    .button-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin: 10px 0;
    }

    .button-group button,
    .button-container button {
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      background-color: #4caf50;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .button-group button:hover,
    .button-container button:hover {
      background-color: #45a049;
      transform: translateY(-2px);
    }

    .summaryResult {
      font-size: 15px;
      font-weight: normal;
      color: blue;
      background-color: #ffffcc;
      border: 2px solid green;
      border-radius: 8px;
      padding: 15px;
      max-width: 800px;
      width: calc(100% - 20px);
      margin: 10px auto;
      line-height: 1.5;
      text-align: center;
      box-sizing: border-box;
    }

    #recordTable {
      width: 100%;
      border-collapse: collapse;
      margin: 10px auto;
    }

    #recordTable th,
    #recordTable td {
      border: 1px solid #ccc;
      padding: 5px;
      line-height: 1.4;
      text-align: center;
    }

    #recordTable th {
      background-color: #f4f4f4;
    }

    #recordTable tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    #recordTable tr:hover {
      background-color: #f1f1f1;
    }

    @media screen and (max-width: 600px) {
      .button-group,
      .button-container {
        grid-template-columns: 1fr;
      }
    }
    
    /* New styles for date summary sections */
    .date-summary-section {
      margin-bottom: 20px;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 8px;
      background-color: #f9f9f9;
    }
    
    .date-summary-title {
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
      text-align: center;
    }
  </style>
</head>
<body>

  <div style="text-align: center; margin-top: 20px;">
    <button class="back-button" onclick="window.location.href='https://juckphai.github.io/juckphai/01.html'">กลับสู่หน้าหลัก</button>
  </div>
<div class="container">
  <h1 style="text-align: center; color: blue; font-size: 16px;">
    ชื่อบัญชี - <span id="accountName"></span>
  </h1>
  <div style="text-align: center;">
    <input type="file" id="fileInput" onchange="loadFromFile(event)" style="display: none;" accept=".json,application/json">
    <button type="button" onclick="document.getElementById('fileInput').click()" class="file-button">โหลดข้อมูล</button>
  </div>
  
  <!-- กลุ่มเลือกบัญชี -->
  <div class="date-summary-section">
    <div class="date-summary-title">เลือกบัญชี</div>
    <label for="accountSelect">เลือกบัญชี:</label>
    <select id="accountSelect" onchange="changeAccount()"></select>
    <div class="button-group">
      <button type="button" onclick="addAccount()">เพิ่มบช.ใหม่</button>
      <button type="button" onclick="deleteAccount()">ลบบช.</button>
      <button type="button" onclick="editAccount()">แก้ไขชื่อบช.</button>
    </div>
  </div>

  <!-- กลุ่มเพิ่มข้อมูล -->
  <div class="date-summary-section">
    <div class="date-summary-title">เพิ่มข้อมูล</div>
    <div class="entry-form">
      <div class="entry-group">
        <label for="entryDate">วันที่ (วัน/เดือน/ปี)</label>
        <input type="text" id="entryDate" placeholder="เช่น 10/11/2024">
      </div>
      <div class="entry-group">
        <label for="entryTime">เวลา (HH.MM)</label>
        <input type="text" id="entryTime" placeholder="เช่น 14.30" pattern="\d{1,2}\.\d{2}">
      </div>
    </div>
    <div class="entry-group">
      <label for="amount">จำนวนเงิน</label>
      <input type="number" id="amount" required>
    </div>
    <div class="entry-group">
      <label for="type">ประเภท</label>
      <select id="type" required>
        <option value="รายจ่าย">ชื้อหวย</option>
        <option value="รายรับ">ถูกหวย</option>
        <option value="เพิ่มทุน">เพิ่มทุน</option>
        <option value="ถอนทุน">ถอนทุน</option>
      </select>
    </div>
    <div class="entry-group">
      <label for="description">รายละเอียด</label>
      <input type="text" id="description" required>
    </div>

    <div class="button-container" style="text-align: center;">
      <button type="button" onclick="addEntry()">เพิ่มข้อมูล</button>
    </div>
  </div>


  <!-- กลุ่มสรุปช่วงเวลา -->
  <div class="date-summary-section">
    <div class="date-summary-title">สรุปวันที่ถึงวันที่</div>
    <div class="entry-form">
      <div class="entry-group">
        <label for="startDate">จากวันที่ (วัน/เดือน/ปี):</label>
        <input type="text" id="startDate" placeholder="เช่น 10/11/2024">
      </div>
      <div class="entry-group">
        <label for="endDate">ถึงวันที่ (วัน/เดือน/ปี):</label>
        <input type="text" id="endDate" placeholder="เช่น 15/11/2024">
      </div>
    </div>
    <div class="button-container" style="text-align: center; margin-top: 10px;">
      <button type="button" onclick="summarize()">สรุปวันที่ถึงวันที่</button>
    </div>
  </div>

  <!-- กลุ่มสรุปวันที่เลือก -->
  <div class="date-summary-section">
    <div class="date-summary-title">สรุปวันที่เลือก</div>
    <div class="entry-form">
      <div class="entry-group">
        <label for="customDayMonth">วันที่ (วัน/เดือน/ปี):</label>
        <input type="text" id="customDayMonth" placeholder="เช่น 10/11/2024">
      </div>
    </div>
    <div class="button-container" style="text-align: center; margin-top: 10px;">
      <button type="button" onclick="summarizeByDayMonth()">สรุปวันที่เลือก</button>
    </div>
  </div>

  <!-- แถวที่ 2 -->
  <div class="date-summary-section">
    <div class="button-container" style="display: flex; gap: 10px; margin-top: 10px;">
      <button type="button" onclick="summarizeToday()" style="flex: 5;">สรุปวันนี้</button>
      <button onclick="toggleRecordsVisibility()" style="flex: 5;">แสดงรายการ</button>
    </div>

    <!-- แถวที่ 3 -->
    <div class="button-container" style="display: flex; gap: 10px; margin-top: 10px;">
      <button type="button" onclick="saveToFile()" style="flex: 5;">บันทึก</button>
      <button type="button" onclick="saveToLocal()" style="flex: 5;">บันทึกเพื่อเปิดอีก</button>
    </div>
  </div>
</div>

<!-- กล่องรายการและสรุป - Responsive Design -->
<div id="detailsSection" style="display: none; margin-top: 20px; width: 100%; overflow-x: auto;">
  <table id="recordTable" style="width: 98%; border-collapse: collapse; min-width: 600px;">
    <thead>
      <tr style="background-color: #f2f2f2;">
        <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">วันเดือนปี</th>
        <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">เวลา</th>
        <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">ประเภท</th>
        <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">รายละเอียด</th>
        <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">จำนวนเงิน</th>
        <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">การจัดการ</th>
      </tr>
    </thead>
    <tbody id="recordBody" style="font-size: 14px;">
      <!-- Rows will be inserted here by JavaScript -->
    </tbody>
  </table>
</div>

<style>
  @media screen and (max-width: 768px) {
    #detailsSection {
      margin: 10px 0;
    }
    #recordTable {
      font-size: 13px;
    }
    #recordTable th, 
    #recordTable td {
      padding: 6px 4px;
    }
  }
  
  @media screen and (max-width: 480px) {
    #detailsSection {
      margin: 5px 0;
    }
    #recordTable {
      min-width: 100%;
    }
  }
</style>

<div id="summaryResult" class="summaryResult"></div>
    <script>
        const accounts = [];
        let currentAccount = null;
        const records = [];
        let editingIndex = null;

        function toggleRecordsVisibility() {
            const recordsContainer = document.getElementById('recordsContainer');
            recordsContainer.style.display = recordsContainer.style.display === 'none' ? 'block' : 'none';
        }

        function addAccount() {
            const accountName = prompt("กรุณากรอกชื่อบัญชีใหม่:");
            if (accountName && !accounts.includes(accountName)) {
                accounts.push(accountName);
                updateAccountSelect();
                alert("เพิ่มบัญชีสำเร็จ");
            } else {
                alert("ชื่อบัญชีซ้ำหรือกรอกข้อมูลไม่ถูกต้อง");
            }
        }

        function updateAccountSelect() {
            const accountSelect = document.getElementById('accountSelect');
            accountSelect.innerHTML = '<option value="">เลือกบัญชี</option>';
            accounts.forEach(account => {
                const option = document.createElement('option');
                option.value = account;
                option.textContent = account;
                accountSelect.appendChild(option);
            });
        }

        function changeAccount() {
            currentAccount = document.getElementById('accountSelect').value;
            document.getElementById('accountName').textContent = currentAccount || "";
            displayRecords();
        }

        function editAccount() {
            if (!currentAccount) {
                alert("กรุณาเลือกบัญชีที่ต้องการแก้ไข");
                return;
            }

            const newAccountName = prompt("กรุณากรอกชื่อบัญชีใหม่:", currentAccount);
            if (newAccountName && newAccountName !== currentAccount && !accounts.includes(newAccountName)) {
                const index = accounts.indexOf(currentAccount);
                if (index > -1) {
                    accounts[index] = newAccountName;
                    records.forEach(record => {
                        if (record.account === currentAccount) {
                            record.account = newAccountName;
                        }
                    });
                    currentAccount = newAccountName;
                    updateAccountSelect();
                    document.getElementById('accountName').textContent = currentAccount;
                    displayRecords();
                    alert("แก้ไขชื่อบัญชีเรียบร้อย");
                }
            } else {
                alert("ชื่อบัญชีซ้ำหรือกรอกข้อมูลไม่ถูกต้อง");
            }
        }

        function deleteAccount() {
            if (currentAccount) {
                const confirmDelete = confirm(`คุณแน่ใจว่าจะลบบัญชี "${currentAccount}" หรือไม่?`);
                if (confirmDelete) {
                    const index = accounts.indexOf(currentAccount);
                    if (index > -1) {
                        accounts.splice(index, 1);
                        currentAccount = null;
                        updateAccountSelect();
                        displayRecords();
                        alert("ลบบัญชีเรียบร้อย");
                    }
                }
            } else {
                alert("กรุณาเลือกบัญชีที่ต้องการลบ");
            }
        }

    function addEntry() {
        let entryDateInput = document.getElementById('entryDate').value.trim();
        let entryTimeInput = document.getElementById('entryTime').value.trim();
        const type = document.getElementById('type').value;
        const description = document.getElementById('description').value;
        const amount = parseFloat(document.getElementById('amount').value);

        // ตรวจสอบและกำหนดค่าวันที่ถ้าไม่ได้กรอก
        let selectedDate;
        if (!entryDateInput) {
            // ถ้าไม่กรอกวันที่ ให้ใช้วันปัจจุบัน
            selectedDate = new Date();
        } else {
            // ตรวจสอบรูปแบบวันที่
            if (!/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(entryDateInput)) {
                alert("กรุณากรอกวัน/เดือน/ปี ในรูปแบบ วัน/เดือน/ปี (เช่น 10/11/2024)");
                return;
            }
            const [day, month, year] = entryDateInput.split('/');
            selectedDate = new Date(year, month - 1, day);
        }

        // ตรวจสอบและกำหนดค่าเวลาถ้าไม่ได้กรอก
        let hours, minutes;
        if (!entryTimeInput) {
            // ถ้าไม่กรอกเวลา ให้ใช้เวลาปัจจุบัน
            const now = new Date();
            hours = String(now.getHours()).padStart(2, '0');
            minutes = String(now.getMinutes()).padStart(2, '0');
        } else {
            // ตรวจสอบรูปแบบเวลา
            if (!/^\d{1,2}\.\d{2}$/.test(entryTimeInput)) {
                alert("กรุณากรอกเวลาในรูปแบบ HH.MM (เช่น 14.30)");
                return;
            }
            [hours, minutes] = entryTimeInput.split('.');
            hours = String(hours).padStart(2, '0');
            minutes = String(minutes).padStart(2, '0');
        }

        const timeString = `${hours}:${minutes}`;
        const formattedDate = `${selectedDate.getFullYear()}-${String(selectedDate.getMonth() + 1).padStart(2, '0')}-${String(selectedDate.getDate()).padStart(2, '0')}`;
        const dateTime = `${formattedDate} ${timeString}`;

        if (!currentAccount) {
            alert("กรุณาเลือกบัญชีก่อนเพิ่มข้อมูล");
            return;
        }

        if (!type || !description || isNaN(amount)) {
            alert("กรุณากรอกข้อมูลให้ครบถ้วน");
            return;
        }

        if (editingIndex !== null) {
            records[editingIndex] = { dateTime, type, description, amount, account: currentAccount };
            editingIndex = null;
        } else {
            records.push({ dateTime, type, description, amount, account: currentAccount });
        }
        
        displayRecords();
        document.getElementById('description').value = '';
        document.getElementById('amount').value = '';
        document.getElementById('entryDate').value = '';
        document.getElementById('entryTime').value = '';
    }

        function displayRecords() {
            const recordBody = document.getElementById('recordBody');
            recordBody.innerHTML = "";

            records.sort((a, b) => new Date(b.dateTime) - new Date(a.dateTime));

            records.forEach((record, index) => {
                if (record.account === currentAccount) {
                    const dateTime = new Date(record.dateTime);
                    const formattedDate = `${String(dateTime.getDate()).padStart(2, '0')}/${String(dateTime.getMonth() + 1).padStart(2, '0')}/${dateTime.getFullYear()}`;
                    const formattedTime = `${String(dateTime.getHours()).padStart(2, '0')}.${String(dateTime.getMinutes()).padStart(2, '0')} น.`;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${formattedDate}</td>
                        <td>${formattedTime}</td>
                        <td>${record.type}</td>
                        <td>${record.description}</td>
                        <td>${record.amount.toLocaleString()} บาท</td>
                        <td>
                            <button onclick="editRecord(${index})">แก้ไข</button>
                            <button onclick="deleteRecord(${index})">ลบ</button>
                        </td>
                    `;
                    recordBody.appendChild(row);
                }
            });

            if (recordBody.innerHTML === "") {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" style="text-align: center;">ไม่มีข้อมูล</td>
                `;
                recordBody.appendChild(row);
            }
        }

     function editRecord(index) {
        const record = records[index];
        document.getElementById('type').value = record.type;
        document.getElementById('description').value = record.description;
        document.getElementById('amount').value = record.amount;
        
        const [datePart, timePart] = record.dateTime.split(' ');
        const [year, month, day] = datePart.split('-');
        document.getElementById('entryDate').value = `${day}/${month}/${year}`;
        
        const [hours, minutes] = timePart.split(':');
        document.getElementById('entryTime').value = `${hours}.${minutes}`;
        
        editingIndex = index;
    }


        function deleteRecord(index) {
            if (confirm("คุณแน่ใจว่าจะลบรายการนี้หรือไม่?")) {
                records.splice(index, 1);
                displayRecords();
            }
        }

        function parseDateInput(dateStr) {
            if (!dateStr || !/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(dateStr)) {
                return null;
            }
            const [day, month, year] = dateStr.split('/');
            return new Date(year, month - 1, day);
        }

        function summarizeByDayMonth() {
            const dayMonth = document.getElementById('customDayMonth').value.trim();

            if (!dayMonth || !/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(dayMonth)) {
                alert("กรุณากรอกวัน/เดือน/ปี ค.ศ. ในรูปแบบ วัน/เดือน/ปี (เช่น 10/11/2024)");
                return;
            }

            const [day, month, year] = dayMonth.split('/');
            const christianYear = parseInt(year);

            const startOfDay = new Date(christianYear, month - 1, day, 0, 0, 0, 0);
            const endOfDay = new Date(christianYear, month - 1, day, 23, 59, 59, 999);

            let totalIncomeToday = 0;
            let totalExpenseToday = 0;
            let totalIncrease = 0;
            let totalWithdrawal = 0;
            let totalExpense = 0;
            let totalIncome = 0;
            let increaseCount = 0;
            let withdrawalCount = 0;
            let incomeCountToday = 0;
            let expenseCountToday = 0;
            let incomeCount = 0;
            let expenseCount = 0;

            records.forEach(record => {
                const recordDate = new Date(record.dateTime);

                if (
                    recordDate >= startOfDay && 
                    recordDate <= endOfDay && 
                    record.account === currentAccount
                ) {
                    if (record.type === "รายรับ") {
                        totalIncomeToday += record.amount;
                        incomeCountToday++;
                    }
                    if (record.type === "รายจ่าย") {
                        totalExpenseToday += record.amount;
                        expenseCountToday++;
                    }
                }

                if (recordDate <= endOfDay && record.account === currentAccount) {
                    if (record.type === "เพิ่มทุน") {
                        totalIncrease += record.amount;
                        increaseCount++;
                    }
                    if (record.type === "รายรับ") {
                        totalIncome += record.amount;
                        incomeCount++;
                    }
                    if (record.type === "ถอนทุน") {
                        totalWithdrawal += record.amount;
                        withdrawalCount++;
                    }
                    if (record.type === "รายจ่าย") {
                        totalExpense += record.amount;
                        expenseCount++;
                    }
                }
            });

            const netBalance = totalIncrease + totalIncome - totalExpense - totalWithdrawal;
            const netTotalToday = totalIncomeToday - totalExpenseToday;

            const thaiDate = new Date(startOfDay);
            const thaiMonth = thaiDate.toLocaleString('th-TH', { month: 'long' });
            const thaiDay = thaiDate.getDate();
            const thaiYear = thaiDate.getFullYear() + 543;

            const summaryDateTime = new Date().toLocaleString("th-TH", {
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit', 
                minute: '2-digit'
            }) + ' น.';

            const remark = prompt("กรุณากรอกหมายเหตุ (ถ้าไม่กรอกจะใช้ 'No comment'):", "No comment") || "No comment";

            document.getElementById('summaryResult').innerHTML = `
                <p>สรุป : ${currentAccount}</p>
                <p>สรุปเมื่อ : ${summaryDateTime}</p>
                <p>สรุปยอดของวันที่ : ${thaiDay} ${thaiMonth} ${thaiYear}</p>
                <p>ถูกหวยวันสรุปยอด : ${totalIncomeToday.toLocaleString()} บาท (ถูก ${incomeCountToday} รอบ)</p>
                <p>ชื้อหวยวันสรุปยอด : ${totalExpenseToday.toLocaleString()} บาท (รวมชื้อ ${expenseCountToday} รอบ)</p>
                <p>ยอดสุทธิวันสรุปยอด : <span style="color: ${netTotalToday >= 0 ? 'red' : 'green'};">${netTotalToday.toLocaleString()}</span> บาท</p>
                <p>เงินในบัญชีเหลืออยู่ถึงวันที่สรุป: <span style="color: ${netBalance >= 0 ? 'red' : 'green'};">${netBalance.toLocaleString()}</span> บาท</p>
                <p>เพิ่มทุนถึงวันนี้ : ${increaseCount} ครั้ง รวม ${totalIncrease.toLocaleString()} บาท</p>
                <p>ถอนทุนถึงวันนี้ : ${withdrawalCount} ครั้ง รวม ${totalWithdrawal.toLocaleString()} บาท</p>
        <p>ข้อความเพิ่ม : <span style="color: orange;">${remark}</span></p>
    `;

    document.getElementById('summaryResult').innerHTML = resultHTML;
}

function summarize() {
    const startDateInput = document.getElementById('startDate').value.trim();
    const endDateInput = document.getElementById('endDate').value.trim();

    if (!startDateInput || !endDateInput) {
        alert("กรุณาเลือกวันที่ให้ครบถ้วน");
        return;
    }

    if (!/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(startDateInput) || !/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(endDateInput)) {
        alert("กรุณากรอกวัน/เดือน/ปี ค.ศ. ในรูปแบบ วัน/เดือน/ปี (เช่น 10/11/2024)");
        return;
    }

    const [startDay, startMonth, startYear] = startDateInput.split('/');
    const [endDay, endMonth, endYear] = endDateInput.split('/');

    const startDate = new Date(startYear, startMonth - 1, startDay, 0, 0, 0, 0);
    const endDate = new Date(endYear, endMonth - 1, endDay, 23, 59, 59, 999);

    if (startDate > endDate) {
        alert("วันที่เริ่มต้นต้องน้อยกว่าหรือเท่ากับวันที่สิ้นสุด");
        return;
    }

    const timeDiff = Math.abs(endDate.getTime() - startDate.getTime());
    const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24)) + 1;

    let totalIncome = 0;
    let totalExpense = 0;
    let totalIncrease = 0;
    let totalWithdrawal = 0;

    let incomeCount = 0;
    let expenseCount = 0;
    let increaseCount = 0;
    let withdrawalCount = 0;

    let allIncome = 0;
    let allExpense = 0;
    let allIncrease = 0;
    let allWithdrawal = 0;

    records.forEach(record => {
        if (record.account !== currentAccount) return;

        const recordDate = new Date(record.dateTime);

        // สรุปยอดเฉพาะในช่วงวันที่เลือก
        if (recordDate >= startDate && recordDate <= endDate) {
            switch (record.type) {
                case "รายรับ":
                    totalIncome += record.amount;
                    incomeCount++;
                    break;
                case "รายจ่าย":
                    totalExpense += record.amount;
                    expenseCount++;
                    break;
                case "เพิ่มทุน":
                    totalIncrease += record.amount;
                    increaseCount++;
                    break;
                case "ถอนทุน":
                    totalWithdrawal += record.amount;
                    withdrawalCount++;
                    break;
            }
        }

        // สำหรับคำนวณยอดเงินคงเหลือ – นับทั้งหมดตั้งแต่ต้นจนถึง endDate
        if (recordDate <= endDate) {
            switch (record.type) {
                case "รายรับ":
                    allIncome += record.amount;
                    break;
                case "รายจ่าย":
                    allExpense += record.amount;
                    break;
                case "เพิ่มทุน":
                    allIncrease += record.amount;
                    break;
                case "ถอนทุน":
                    allWithdrawal += record.amount;
                    break;
            }
        }
    });

    // ✅ ตามเงื่อนไขที่คุณกำหนด
    const netTotal = (totalIncome + totalIncrease) - (totalExpense + totalWithdrawal);
    const accountBalance = (allIncome + allIncrease) - (allExpense + allWithdrawal);

    const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
    const startDateStr = startDate.toLocaleDateString('th-TH', options);
    const endDateStr = endDate.toLocaleDateString('th-TH', options);
    const summaryTime = new Date().toLocaleString('th-TH', {
        day: '2-digit', month: '2-digit', year: 'numeric',
        hour: '2-digit', minute: '2-digit'
    }) + ' น.';

    const remark = prompt("กรุณากรอกหมายเหตุ (ถ้าไม่กรอกจะใช้ 'No comment'):", "No comment") || "No comment";

    let resultHTML = `
        <p>สรุปยอดบัญชี: ${currentAccount}</p>
        <p>สรุปเมื่อ: ${summaryTime}</p>
        <p>ช่วงวันที่: ${startDateStr} ถึง ${endDateStr} (${daysDiff} วัน)</p>
        <p>สรุปยอดในช่วงวันที่เลือก</p>
        <p>ถูกหวย: ${totalIncome.toLocaleString()} บาท (${incomeCount} ครั้ง)</p>
        <p>ชื้อหวย: ${totalExpense.toLocaleString()} บาท (${expenseCount} ครั้ง)</p>
        <p>เพิ่มทุน: ${totalIncrease.toLocaleString()} บาท (${increaseCount} ครั้ง)</p>
        <p>ถอนทุน: ${totalWithdrawal.toLocaleString()} บาท (${withdrawalCount} ครั้ง)</p>
        <p>ยอดสุทธิในช่วงวันที่เลือก</p>
        <p style="font-size: 16px; color: ${netTotal >= 0 ? 'green' : 'red'};">
            ${netTotal >= 0 ? 'ได้กำไร' : 'ขาดทุน'}: ${Math.abs(netTotal).toLocaleString()} บาท
        </p>
        <p>ยอดเงินคงเหลือในบัญชี</p>
        <p style="font-size: 16px; color: ${accountBalance >= 0 ? 'green' : 'red'};">
            ${accountBalance.toLocaleString()} บาท
        </p>
        <p>ข้อความเพิ่ม : <span style="color: orange;">${remark}</span></p>
    `;

    document.getElementById('summaryResult').innerHTML = resultHTML;
}

        function summarizeToday() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const endOfToday = new Date(today);
            endOfToday.setHours(23, 59, 59, 999);

            let totalIncomeToday = 0;
            let totalExpenseToday = 0;
            let totalIncomeAll = 0;
            let totalExpenseAll = 0;
            let totalIncrease = 0;
            let totalWithdrawal = 0;
            let incomeCountToday = 0;
            let expenseCountToday = 0;
            let increaseCount = 0;
            let withdrawalCount = 0;

            records.forEach(record => {
                const [date, time] = record.dateTime.split(" ");
                const [year, month, day] = date.split("-");
                const recordDate = new Date(year, month - 1, day);

                if (record.account === currentAccount) {
                    if (recordDate >= today && recordDate <= endOfToday) {
                        if (record.type === "รายรับ") {
                            totalIncomeToday += record.amount;
                            incomeCountToday++;
                        }
                        if (record.type === "รายจ่าย") {
                            totalExpenseToday += record.amount;
                            expenseCountToday++;
                        }
                    }

                    if (record.type === "เพิ่มทุน") {
                        totalIncrease += record.amount;
                        increaseCount++;
                    } else if (record.type === "ถอนทุน") {
                        totalWithdrawal += record.amount;
                        withdrawalCount++;
                    }

                    if (record.type === "รายรับ") totalIncomeAll += record.amount;
                    if (record.type === "รายจ่าย") totalExpenseAll += record.amount;
                }
            });

            const netTotal = totalIncomeToday - totalExpenseToday;
            let remark = '';
            if (netTotal > 0) {
                remark = `ถูกหวยได้มากกว่าชื้อหวย ${netTotal.toLocaleString()} บาท`;
            } else if (netTotal < 0) {
                remark = `ชื้อหวยมากกว่าถูกหวย ${Math.abs(netTotal).toLocaleString()} บาท`;
            } else {
                remark = 'ชื้อหวยและถูกหวยเท่ากัน';
            }

            const accountBalance = totalIncrease + totalIncomeAll - totalExpenseAll - totalWithdrawal;

            const summaryDateTime = new Date().toLocaleString("th-TH", {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            }) + ' น.';

            const remarkInput = prompt("กรุณากรอกหมายเหตุ (ถ้าไม่กรอกจะใช้ 'No comment'):", "No comment") || "No comment";

            document.getElementById('summaryResult').innerHTML = `
                <p>สรุปวันนี้ : ${currentAccount}</p>
                <p>${summaryDateTime}</p>
                <p>
                    ถูกหวยวันนี้ : ${totalIncomeToday.toLocaleString()} บาท 
                    <span style="margin-left: 20px;">ถูก : ${incomeCountToday} รอบ</span>
                </p>
                <p>
                    ชื้อหวยวันนี้ : ${totalExpenseToday.toLocaleString()} บาท 
                    <span style="margin-left: 20px;">ชื้อ : ${expenseCountToday} รอบ</span>
                </p>
                <p>สรุปยอดสุทธิ : <span style="color: red;">${netTotal.toLocaleString()}</span> บาท</p>
                <hr>
        <p>หมายเหตุ : ${
          remark.replace(/\d+(,\d{3})*/g, (num) => {
            return `<span style="color: red;">${num}</span>`;
          })
        }</p>
                <p>
                    <span style="color: blue;">เงินในบัญชีถึงวันนี้เหลืออยู่ :</span> 
                    <span style="color: red;">${accountBalance.toLocaleString()}</span> บาท
                </p>
                <p>เพิ่มทุนถึงวันนี้ : ${increaseCount} ครั้ง รวม ${totalIncrease.toLocaleString()} บาท</p>
                <p>ถอนทุนถึงวันนี้ : ${withdrawalCount} ครั้ง รวม ${totalWithdrawal.toLocaleString()} บาท</p>
                <p>ข้อความเพิ่ม : <span style="color: orange;">${remarkInput}</span></p>
            `;
        }

function toggleRecordsVisibility() {
    const detailsSection = document.getElementById('detailsSection');
    if (detailsSection.style.display === 'none' || detailsSection.style.display === '') {
        detailsSection.style.display = 'block';
    } else {
        detailsSection.style.display = 'none';
    }
}

        function saveToFile() {
            const fileName = prompt("กรุณากรอกชื่อไฟล์ (ไม่ต้องใส่นามสกุล):");
            if (!fileName) {
                alert("กรุณากรอกชื่อไฟล์");
                return;
            }

            const now = new Date();
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = now.getFullYear();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const dateTimeString = `${day}${month}${year}_${hours}${minutes}`;

            const fullFileName = `${fileName}_${dateTimeString}.json`;

            const data = { accounts, currentAccount, records };
            const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fullFileName;
            a.click();
            URL.revokeObjectURL(url);
        }

        function loadFromFile(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            // ตรวจสอบประเภทไฟล์
            if (!file.name.endsWith('.json') && file.type !== 'application/json') {
                alert("กรุณาเลือกไฟล์ JSON เท่านั้น");
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    accounts.length = 0;
                    accounts.push(...data.accounts);
                    currentAccount = data.currentAccount;
                    records.length = 0;
                    records.push(...data.records);
                    updateAccountSelect();
                    changeAccount();
                    alert("โหลดข้อมูลสำเร็จ");
                } catch (error) {
                    alert("ไฟล์ไม่ถูกต้องหรือเสียหาย: " + error.message);
                }
            };
            reader.onerror = function() {
                alert("เกิดข้อผิดพลาดในการอ่านไฟล์");
            };
            reader.readAsText(file);
        }

        function saveToLocal() {
            const data = {
                accounts,
                currentAccount,
                records
            };
            localStorage.setItem('accountData', JSON.stringify(data));
            alert('บันทึกข้อมูลสำหรับเปิดใช้งานครั้งต่อไปเรียบร้อยแล้ว');
        }

        function loadFromLocal() {
            const data = localStorage.getItem('accountData');
            if (data) {
                try {
                    const parsed = JSON.parse(data);
                    accounts.length = 0;
                    accounts.push(...parsed.accounts || []);
                    currentAccount = parsed.currentAccount || null;
                    records.length = 0;
                    records.push(...parsed.records || []);
                    updateAccountSelect();
                    changeAccount();
                } catch (error) {
                    console.error("โหลดข้อมูลจาก LocalStorage ไม่สำเร็จ", error);
                }
            }
        }

        // เรียกใช้เมื่อเปิดหน้าเว็บ
        window.onload = function () {
            document.getElementById('detailsSection').style.display = 'none';
            loadFromLocal();
        };
    </script>
</body>
</html>
