<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>บัญชีหวย</title>
  <style>
    /* Base Styles */
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f7fb;
      margin: 0;
      padding: 0;
    }

    h2 {
      text-align: center;
      color: #333;
      margin-top: 30px;
      font-size: 28px;
    }

    /* Layout Styles */
    .container {
      max-width: 800px;
      margin: 20px auto;
      background-color: #ffffff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .entry-form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .entry-group {
      display: flex;
      flex-direction: column;
    }

    .button-group,
    .button-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin: 10px 0;
    }

    /* Form Elements */
    label {
      font-weight: bold;
      color: #333;
      font-size: 16px;
      margin-bottom: 5px;
    }

    select,
    input[type="text"],
    input[type="number"],
    input[type="date"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
      background-color: #f9f9f9;
      box-sizing: border-box;
    }

    /* Hide number input spinners */
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type=number] {
      -moz-appearance: textfield;
    }

    /* Button Styles */
    .back-button,
    .file-button {
      font-size: 16px;
      padding: 10px 20px;
      border-radius: 10px;
      border: none;
      width: 50%;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
      margin: 10px;
    }

    .back-button {
      background-color: #ff5722;
    }

    .back-button:hover {
      background-color: #e64a19;
    }

    .file-button {
      background-color: #007bff;
    }

    .file-button:hover {
      background-color: #0056b3;
    }

    .button-group button,
    .button-container button {
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      background-color: #4caf50;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .button-group button:hover,
    .button-container button:hover {
      background-color: #45a049;
      transform: translateY(-2px);
    }

    /* Table Styles */
    #recordTable {
      width: 100%;
      border-collapse: collapse;
      margin: 10px auto;
    }

    #recordTable th,
    #recordTable td {
      border: 1px solid #ccc;
      padding: 5px;
      line-height: 1.4;
      text-align: center;
    }

    #recordTable th {
      background-color: #f4f4f4;
    }

    #recordTable tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    #recordTable tr:hover {
      background-color: #f1f1f1;
    }

    /* Summary Styles */
    .summaryResult {
      font-size: 15px;
      font-weight: normal;
      color: blue;
      background-color: #ffffcc;
      border: 2px solid green;
      border-radius: 8px;
      padding: 15px;
      max-width: 800px;
      width: calc(100% - 20px);
      margin: 10px auto;
      line-height: 1.5;
      text-align: center;
      box-sizing: border-box;
    }

    .date-summary-section {
      margin-bottom: 20px;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 8px;
      background-color: #f9f9f9;
    }
    
    .date-summary-title {
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
      text-align: center;
    }

    /* Responsive Styles */
    @media screen and (max-width: 600px) {
      .button-group,
      .button-container {
        grid-template-columns: 1fr;
      }
      
      .container {
        width: 95%;
        padding: 15px;
        margin: 10px auto;
      }
      
      h2 {
        font-size: 22px;
        margin-top: 15px;
      }
      
      .back-button, 
      .file-button {
        width: 90%;
        padding: 12px;
        font-size: 18px;
        margin: 8px auto;
      }
      
      .entry-form {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      #recordTable {
        font-size: 14px;
      }
      
      #recordTable th, 
      #recordTable td {
        padding: 3px;
      }
      
      .button-group button, 
      .button-container button {
        padding: 14px;
        font-size: 18px;
      }
      
      .summaryResult {
        font-size: 14px;
        padding: 10px;
      }
      
      .date-summary-section {
        padding: 10px;
      }
      
      select,
      input[type="text"],
      input[type="number"],
      input[type="date"] {
        font-size: 16px;
        padding: 12px;
      }
    }
    
    /* Opera Mini Specific */
    @media all and (-webkit-min-device-pixel-ratio:0) and (max-width: 480px) {
      body {
        -webkit-text-size-adjust: 100%;
      }
      
      .container {
        min-width: 320px;
      }
    }
    /* เพิ่มสไตล์สำหรับแถบควบคุม */
    .control-panel {
      background-color: #f8f9fa;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      text-align: center;
    }
    
    .control-panel button {
      background-color: #4caf50;
      color: white;
      padding: 8px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 0 5px;
      font-size: 14px;
      transition: background-color 0.3s;
    }
    
    .control-panel button:hover {
      background-color: #5a6268;
    }
    
    .section-container {
      transition: all 0.3s ease;
    }
    
    .collapsed {
      display: none;
    }
    
    /* ปรับสไตล์ปุ่มหลัก */
    .main-toggle-btn {
      background-color: #ff5722; !important;
      font-weight: bold;
      padding: 10px 15px !important;
      margin-bottom: 10px !important;
    }
  </style>
</head>
<body>

  <div style="text-align: center; margin-top: 20px;">
    <button class="back-button" onclick="window.location.href='https://juckphai.github.io/juckphai/01.html'">กลับสู่หน้าหลัก</button>
  </div>
<div class="container">
  <h1 style="text-align: center; color: blue; font-size: 16px;">
    ชื่อบัญชี - <span id="accountName"></span>
  </h1>
  <div style="text-align: center;">
    <input type="file" id="fileInput" onchange="loadFromFile(event)" style="display: none;" accept=".json,application/json">
    <button type="button" onclick="document.getElementById('fileInput').click()" class="file-button">โหลดข้อมูลหวย</button>
  </div>
<div class="button-container" style="text-align: center; margin-top: 20px;">
  <button type="button" onclick="exportToExcel()" 
    style="background-color: #28a745; color: white; padding: 12px; border-radius: 5px; border: none; 
           cursor: pointer; width: 50%; font-size: 16px; display: block; margin: 0 auto;">
    ส่งออก Excel
  </button>
</div>
    <div class="control-panel">
      <button class="main-toggle-btn" onclick="toggleAllSections()">แสดงทั้งหมด</button>
      <button onclick="toggleSection('accountSection')">เลือกบัญชี</button>
      <button onclick="toggleSection('addDataSection')">เพิ่มข้อมูล</button>
      <button onclick="toggleSection('dateRangeSummarySection')">สรุปวันที่ถึงวันที่</button>
      <button onclick="toggleSection('customDaySummarySection')">สรุปวันที่เลือก</button>
    </div>
  <!-- กลุ่มเลือกบัญชี -->
<div id="accountSection" class="section-container collapsed">
  <div class="date-summary-section">
    <div class="date-summary-title">เลือกบัญชี</div>
    <label for="accountSelect">เลือกบัญชี:</label>
    <select id="accountSelect" onchange="changeAccount()"></select>
    <div class="button-group">
      <button type="button" onclick="addAccount()">เพิ่มบช.ใหม่</button>
      <button type="button" onclick="deleteAccount()">ลบบช.</button>
      <button type="button" onclick="editAccount()">แก้ไขชื่อบช.</button>
    </div>
  </div>

  <!-- กลุ่มเพิ่มข้อมูล -->
<div id="addDataSection" class="section-container collapsed">
  <div class="date-summary-section">
    <div class="date-summary-title">เพิ่มข้อมูล</div>
    <div class="entry-form">
      <div class="entry-group">
        <label for="entryDate">วันที่ (วัน/เดือน/ปี)</label>
        <input type="text" id="entryDate" placeholder="เช่น 10/11/2024">
      </div>
      <div class="entry-group">
        <label for="entryTime">เวลา (HH.MM)</label>
        <input type="text" id="entryTime" placeholder="เช่น 14.30" pattern="\d{1,2}\.\d{2}">
      </div>
    </div>
    <div class="entry-group">
      <label for="amount">จำนวนเงิน</label>
      <input type="number" id="amount" required>
    </div>
    <div class="entry-group">
      <label for="type">ประเภท</label>
      <select id="type" required>
        <option value="รายจ่าย">ชื้อหวย</option>
        <option value="รายรับ">ถูกหวย</option>
        <option value="เพิ่มทุน">เพิ่มทุน</option>
        <option value="ถอนทุน">ถอนทุน</option>
      </select>
    </div>
    <div class="entry-group">
      <label for="description">รายละเอียด</label>
      <input type="text" id="description" required>
    </div>

    <div class="button-container" style="text-align: center;">
      <button type="button" onclick="addEntry()">เพิ่มข้อมูล</button>
    </div>
  </div>


  <!-- กลุ่มสรุปช่วงเวลา -->
<div id="dateRangeSummarySection" class="section-container collapsed">
  <div class="date-summary-section">
    <div class="date-summary-title">สรุปวันที่ถึงวันที่</div>
    <div class="entry-form">
      <div class="entry-group">
        <label for="startDate">จากวันที่ (วัน/เดือน/ปี):</label>
        <input type="text" id="startDate" placeholder="เช่น 10/11/2024">
      </div>
      <div class="entry-group">
        <label for="endDate">ถึงวันที่ (วัน/เดือน/ปี):</label>
        <input type="text" id="endDate" placeholder="เช่น 15/11/2024">
      </div>
    </div>
    <div class="button-container" style="text-align: center; margin-top: 10px;">
      <button type="button" onclick="summarize()">สรุปวันที่ถึงวันที่</button>
    </div>
  </div>

  <!-- กลุ่มสรุปวันที่เลือก -->
    <div id="customDaySummarySection" class="section-container collapsed">
  <div class="date-summary-section">
    <div class="date-summary-title">สรุปวันที่เลือก</div>
    <div class="entry-form">
      <div class="entry-group">
        <label for="customDayMonth">วันที่ (วัน/เดือน/ปี):</label>
        <input type="text" id="customDayMonth" placeholder="เช่น 10/11/2024">
      </div>
    </div>
    <div class="button-container" style="text-align: center; margin-top: 10px;">
      <button type="button" onclick="summarizeByDayMonth()">สรุปวันที่เลือก</button>
    </div>
  </div>

  <!-- แถวที่ 2 -->
  <div class="date-summary-section">
    <div class="button-container" style="display: flex; gap: 10px; margin-top: 10px;">
      <button type="button" onclick="summarizeToday()" style="flex: 5;">สรุปวันนี้</button>
      <button onclick="toggleRecordsVisibility()" style="flex: 5;">แสดงรายการ</button>
    </div>

    <!-- แถวที่ 3 -->
    <div class="button-container" style="display: flex; gap: 10px; margin-top: 10px;">
      <button type="button" onclick="saveToFile()" style="flex: 5;">บันทึก</button>
      <button type="button" onclick="saveToLocal()" style="flex: 5;">บันทึกเพื่อเปิดอีก</button>
    </div>
  </div>
</div>

<!-- กล่องรายการและสรุป - Responsive Design -->
<div id="detailsSection" style="display: none; margin-top: 20px; width: 100%; overflow-x: auto;">
  <table id="recordTable" style="width: 98%; border-collapse: collapse; min-width: 600px;">
    <thead>
      <tr style="background-color: #f2f2f2;">
        <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">วันเดือนปี</th>
        <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">เวลา</th>
        <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">ประเภท</th>
        <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">รายละเอียด</th>
        <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">จำนวนเงิน</th>
        <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">การจัดการ</th>
      </tr>
    </thead>
    <tbody id="recordBody" style="font-size: 14px;">
      <!-- Rows will be inserted here by JavaScript -->
    </tbody>
  </table>
</div>

<style>
  @media screen and (max-width: 768px) {
    #detailsSection {
      margin: 10px 0;
    }
    #recordTable {
      font-size: 13px;
    }
    #recordTable th, 
    #recordTable td {
      padding: 6px 4px;
    }
  }
  
  @media screen and (max-width: 480px) {
    #detailsSection {
      margin: 5px 0;
    }
    #recordTable {
      min-width: 100%;
    }
  }
</style>

<div id="summaryResult" class="summaryResult"></div>
    <script>
        const accounts = [];
        let currentAccount = null;
        const records = [];
        let editingIndex = null;

        function toggleRecordsVisibility() {
            const recordsContainer = document.getElementById('recordsContainer');
            recordsContainer.style.display = recordsContainer.style.display === 'none' ? 'block' : 'none';
        }

        function addAccount() {
            const accountName = prompt("กรุณากรอกชื่อบัญชีใหม่:");
            if (accountName && !accounts.includes(accountName)) {
                accounts.push(accountName);
                updateAccountSelect();
                alert("เพิ่มบัญชีสำเร็จ");
            } else {
                alert("ชื่อบัญชีซ้ำหรือกรอกข้อมูลไม่ถูกต้อง");
            }
        }

        function updateAccountSelect() {
            const accountSelect = document.getElementById('accountSelect');
            accountSelect.innerHTML = '<option value="">เลือกบัญชี</option>';
            accounts.forEach(account => {
                const option = document.createElement('option');
                option.value = account;
                option.textContent = account;
                accountSelect.appendChild(option);
            });
        }

        function changeAccount() {
            currentAccount = document.getElementById('accountSelect').value;
            document.getElementById('accountName').textContent = currentAccount || "";
            displayRecords();
        }

        function editAccount() {
            if (!currentAccount) {
                alert("กรุณาเลือกบัญชีที่ต้องการแก้ไข");
                return;
            }

            const newAccountName = prompt("กรุณากรอกชื่อบัญชีใหม่:", currentAccount);
            if (newAccountName && newAccountName !== currentAccount && !accounts.includes(newAccountName)) {
                const index = accounts.indexOf(currentAccount);
                if (index > -1) {
                    accounts[index] = newAccountName;
                    records.forEach(record => {
                        if (record.account === currentAccount) {
                            record.account = newAccountName;
                        }
                    });
                    currentAccount = newAccountName;
                    updateAccountSelect();
                    document.getElementById('accountName').textContent = currentAccount;
                    displayRecords();
                    alert("แก้ไขชื่อบัญชีเรียบร้อย");
                }
            } else {
                alert("ชื่อบัญชีซ้ำหรือกรอกข้อมูลไม่ถูกต้อง");
            }
        }

        function deleteAccount() {
            if (currentAccount) {
                const confirmDelete = confirm(`คุณแน่ใจว่าจะลบบัญชี "${currentAccount}" หรือไม่?`);
                if (confirmDelete) {
                    const index = accounts.indexOf(currentAccount);
                    if (index > -1) {
                        accounts.splice(index, 1);
                        currentAccount = null;
                        updateAccountSelect();
                        displayRecords();
                        alert("ลบบัญชีเรียบร้อย");
                    }
                }
            } else {
                alert("กรุณาเลือกบัญชีที่ต้องการลบ");
            }
        }

 function addEntry() {
    let entryDateInput = document.getElementById('entryDate').value.trim();
    let entryTimeInput = document.getElementById('entryTime').value.trim();
    const type = document.getElementById('type').value;
    const description = document.getElementById('description').value; // รับค่าตามปกติแต่ไม่บังคับตรวจสอบ
    const amount = parseFloat(document.getElementById('amount').value);

    // ตรวจสอบและกำหนดค่าวันที่ถ้าไม่ได้กรอก
    let selectedDate;
    if (!entryDateInput) {
        // ถ้าไม่กรอกวันที่ ให้ใช้วันปัจจุบัน
        selectedDate = new Date();
    } else {
        // ตรวจสอบรูปแบบวันที่
        if (!/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(entryDateInput)) {
            alert("กรุณากรอกวัน/เดือน/ปี ในรูปแบบ วัน/เดือน/ปี (เช่น 10/11/2024)");
            return;
        }
        const [day, month, year] = entryDateInput.split('/');
        selectedDate = new Date(year, month - 1, day);
    }

    // ตรวจสอบและกำหนดค่าเวลาถ้าไม่ได้กรอก
    let hours, minutes;
    if (!entryTimeInput) {
        // ถ้าไม่กรอกเวลา ให้ใช้เวลาปัจจุบัน
        const now = new Date();
        hours = String(now.getHours()).padStart(2, '0');
        minutes = String(now.getMinutes()).padStart(2, '0');
    } else {
        // ตรวจสอบรูปแบบเวลา
        if (!/^\d{1,2}\.\d{2}$/.test(entryTimeInput)) {
            alert("กรุณากรอกเวลาในรูปแบบ HH.MM (เช่น 14.30)");
            return;
        }
        [hours, minutes] = entryTimeInput.split('.');
        hours = String(hours).padStart(2, '0');
        minutes = String(minutes).padStart(2, '0');
    }

    const timeString = `${hours}:${minutes}`;
    const formattedDate = `${selectedDate.getFullYear()}-${String(selectedDate.getMonth() + 1).padStart(2, '0')}-${String(selectedDate.getDate()).padStart(2, '0')}`;
    const dateTime = `${formattedDate} ${timeString}`;

    if (!currentAccount) {
        alert("กรุณาเลือกบัญชีก่อนเพิ่มข้อมูล");
        return;
    }

        if (!type || !description || isNaN(amount)) {
            alert("กรุณากรอกข้อมูลให้ครบถ้วน");
            return;
        }

    if (editingIndex !== null) {
        records[editingIndex] = { dateTime, type, description, amount, account: currentAccount };
        editingIndex = null;
    } else {
        records.push({ dateTime, type, description, amount, account: currentAccount });
    }
    
    displayRecords();
    document.getElementById('description').value = '';
    document.getElementById('amount').value = '';
    document.getElementById('entryDate').value = '';
    document.getElementById('entryTime').value = '';
}

        function displayRecords() {
            const recordBody = document.getElementById('recordBody');
            recordBody.innerHTML = "";

            records.sort((a, b) => new Date(b.dateTime) - new Date(a.dateTime));

            records.forEach((record, index) => {
                if (record.account === currentAccount) {
                    const dateTime = new Date(record.dateTime);
                    const formattedDate = `${String(dateTime.getDate()).padStart(2, '0')}/${String(dateTime.getMonth() + 1).padStart(2, '0')}/${dateTime.getFullYear()}`;
                    const formattedTime = `${String(dateTime.getHours()).padStart(2, '0')}.${String(dateTime.getMinutes()).padStart(2, '0')} น.`;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${formattedDate}</td>
                        <td>${formattedTime}</td>
                        <td>${record.type}</td>
                        <td>${record.description}</td>
                        <td>${record.amount.toLocaleString()} บาท</td>
                        <td>
                            <button onclick="editRecord(${index})">แก้ไข</button>
                            <button onclick="deleteRecord(${index})">ลบ</button>
                        </td>
                    `;
                    recordBody.appendChild(row);
                }
            });

            if (recordBody.innerHTML === "") {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" style="text-align: center;">ไม่มีข้อมูล</td>
                `;
                recordBody.appendChild(row);
            }
        }

     function editRecord(index) {
        const record = records[index];
        document.getElementById('type').value = record.type;
        document.getElementById('description').value = record.description;
        document.getElementById('amount').value = record.amount;
        
        const [datePart, timePart] = record.dateTime.split(' ');
        const [year, month, day] = datePart.split('-');
        document.getElementById('entryDate').value = `${day}/${month}/${year}`;
        
        const [hours, minutes] = timePart.split(':');
        document.getElementById('entryTime').value = `${hours}.${minutes}`;
        
        editingIndex = index;
    }


        function deleteRecord(index) {
            if (confirm("คุณแน่ใจว่าจะลบรายการนี้หรือไม่?")) {
                records.splice(index, 1);
                displayRecords();
            }
        }

        function parseDateInput(dateStr) {
            if (!dateStr || !/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(dateStr)) {
                return null;
            }
            const [day, month, year] = dateStr.split('/');
            return new Date(year, month - 1, day);
        }

function summarizeByDayMonth() {
    const dayMonth = document.getElementById('customDayMonth').value.trim();

    if (!dayMonth || !/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(dayMonth)) {
        alert("กรุณากรอกวัน/เดือน/ปี ค.ศ. ในรูปแบบ วัน/เดือน/ปี (เช่น 10/11/2024)");
        return;
    }

    const [day, month, year] = dayMonth.split('/');
    const dateYear = parseInt(year);
    const startOfDay = new Date(dateYear, month - 1, day, 0, 0, 0, 0);
    const endOfDay = new Date(dateYear, month - 1, day, 23, 59, 59, 999);

    let summary = {
        todayIncome: 0,
        todayExpense: 0,
        incomeCountToday: 0,
        expenseCountToday: 0,
        totalIncome: 0,
        totalExpense: 0,
        incomeCount: 0,
        expenseCount: 0,
        totalIncrease: 0,
        totalWithdrawal: 0,
        increaseCount: 0,
        withdrawalCount: 0
    };

    records.forEach(record => {
        const recordDate = new Date(record.dateTime);
        const isCurrentAccount = record.account === currentAccount;
        const isToday = recordDate >= startOfDay && recordDate <= endOfDay;

        if (isToday && isCurrentAccount) {
            if (record.type === "รายรับ") {
                summary.todayIncome += record.amount;
                summary.incomeCountToday++;
            }
            if (record.type === "รายจ่าย") {
                summary.todayExpense += record.amount;
                summary.expenseCountToday++;
            }
        }

        if (recordDate <= endOfDay && isCurrentAccount) {
            switch (record.type) {
                case "เพิ่มทุน":
                    summary.totalIncrease += record.amount;
                    summary.increaseCount++;
                    break;
                case "ถอนทุน":
                    summary.totalWithdrawal += record.amount;
                    summary.withdrawalCount++;
                    break;
                case "รายรับ":
                    summary.totalIncome += record.amount;
                    summary.incomeCount++;
                    break;
                case "รายจ่าย":
                    summary.totalExpense += record.amount;
                    summary.expenseCount++;
                    break;
            }
        }
    });

    const netToday = summary.todayIncome - summary.todayExpense;
    const netBalance = summary.totalIncrease + summary.totalIncome - summary.totalExpense - summary.totalWithdrawal;
    const initialInvestment = summary.totalIncrease - summary.totalWithdrawal;
    const profitFromInvestment = netBalance - initialInvestment;
    
    const roiPercentage = initialInvestment > 0 
        ? ((profitFromInvestment / initialInvestment) * 100).toFixed(2)
        : "0.00";

    const thaiDate = new Date(startOfDay);
    const thaiMonth = thaiDate.toLocaleString('th-TH', { month: 'long' });
    const thaiDay = thaiDate.getDate();
    const thaiYear = thaiDate.getFullYear() + 543;

    const summaryDateTime = new Date().toLocaleString("th-TH", {
        year: 'numeric', month: 'long', day: 'numeric',
        hour: '2-digit', minute: '2-digit'
    }) + ' น.';

    // สรุปผลประจำวัน
    let dailySummary = '';
    if (summary.todayIncome === 0 && summary.todayExpense === 0) {
        dailySummary = 'ไม่มีรายการในวันนี้';
    } else {
        if (netToday > 0) {
            dailySummary = `กำไรสุทธิ ${netToday.toLocaleString()} บาท`;
        } else if (netToday < 0) {
            dailySummary = `ขาดทุนสุทธิ ${Math.abs(netToday).toLocaleString()} บาท`;
        } else {
            dailySummary = 'เสมอตัว';
        }
    }

    // สรุปผลรวมเทียบกับเงินลงทุน
    let investmentMainText = '';
    let investmentColor = profitFromInvestment >= 0 ? 'green' : 'red';
    
    if (profitFromInvestment > 0) {
        investmentMainText = `กำไรสุทธิ <span style="font-weight: bold;">${profitFromInvestment.toLocaleString()} บาท</span>`;
    } else if (profitFromInvestment < 0) {
        investmentMainText = `ขาดทุนสุทธิ <span style="font-weight: bold;">${Math.abs(profitFromInvestment).toLocaleString()} บาท</span>`;
    } else {
        investmentMainText = `เสมอตัว`;
    }

    const investmentSubText = `<small style="font-size: 0.7em;">(จากเงินลงทุน ${initialInvestment.toLocaleString()} บาท)</small>`;

    const customMessage = prompt("กรุณากรอกข้อความเพิ่มเติม (ถ้าไม่กรอกจะใช้ 'No comment'):", "No comment") || "No comment";

    const resultHTML = `
        <p>สรุป : ${currentAccount}</p>
        <p>สรุปเมื่อ : ${summaryDateTime}</p>
        <p>สรุปยอดของวันที่ : ${thaiDay} ${thaiMonth} ${thaiYear}</p>
        <p>ถูกหวยวันสรุปยอด : ${summary.todayIncome.toLocaleString()} บาท (ถูก ${summary.incomeCountToday} รอบ)</p>
        <p>ชื้อหวยวันสรุปยอด : ${summary.todayExpense.toLocaleString()} บาท (รวมชื้อ ${summary.expenseCountToday} รอบ)</p>
        <p>ผลงานวันนี้ : <span style="color: ${netToday >= 0 ? 'green' : 'red'}; font-weight: bold;">${dailySummary}</span></p>
        <hr>
        <p>เงินในบัญชีวันที่สรุป: <span style="color: ${netBalance >= 0 ? 'green' : 'red'};">${netBalance.toLocaleString()}</span> บาท</p>
        <p>ลงทุนถึงวันนี้ : ${summary.increaseCount} ครั้ง รวม ${summary.totalIncrease.toLocaleString()} บาท</p>
        <p>ถอนทุนถึงวันนี้ : ${summary.withdrawalCount} ครั้ง รวม ${summary.totalWithdrawal.toLocaleString()} บาท</p>
        <p>เงินลงทุนสุทธิ : ${initialInvestment.toLocaleString()} บาท</p>
        <p>ผลการลงทุน : <span style="color: ${investmentColor};">${investmentMainText} ${investmentSubText}</span></p>
        <p>ผลการลงทุนถึงวันนี้: 
            <span style="color: ${profitFromInvestment >= 0 ? 'green' : 'red'}; font-weight: bold;">
                ${profitFromInvestment >= 0 ? 'กำไร' : 'ขาดทุน'} ${Math.abs(profitFromInvestment).toLocaleString()} บาท
            </span>
        </p>
        <p>ผลตอบแทนการลงทุน (ROI): 
            <span style="color: ${profitFromInvestment >= 0 ? 'green' : 'red'}; font-weight: bold;">
                ${roiPercentage}%
            </span>
        </p>
        <p>ข้อความเพิ่ม : <span style="color: orange;">${customMessage}</span></p>
    `;

    document.getElementById('summaryResult').innerHTML = resultHTML;
}

function summarize() {
    const startDateInput = document.getElementById('startDate').value.trim();
    const endDateInput = document.getElementById('endDate').value.trim();

    if (!startDateInput || !endDateInput) {
        alert("กรุณาเลือกวันที่ให้ครบถ้วน");
        return;
    }

    if (!/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(startDateInput) || !/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(endDateInput)) {
        alert("กรุณากรอกวัน/เดือน/ปี ค.ศ. ในรูปแบบ วัน/เดือน/ปี (เช่น 10/11/2024)");
        return;
    }

    const [startDay, startMonth, startYear] = startDateInput.split('/');
    const [endDay, endMonth, endYear] = endDateInput.split('/');

    const startDate = new Date(startYear, startMonth - 1, startDay, 0, 0, 0, 0);
    const endDate = new Date(endYear, endMonth - 1, endDay, 23, 59, 59, 999);

    if (startDate > endDate) {
        alert("วันที่เริ่มต้นต้องน้อยกว่าหรือเท่ากับวันที่สิ้นสุด");
        return;
    }

    const timeDiff = Math.abs(endDate.getTime() - startDate.getTime());
    const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));

    // ตัวแปรสำหรับคำนวณยอดสุทธิ
    let totalLotteryWin = 0;    // รวมเงินที่ถูกหวย
    let totalLotteryBuy = 0;    // รวมเงินที่ซื้อหวย
    let totalProfitLoss = 0;    // กำไร/ขาดทุนรวม
    
    // ตัวแปรสำหรับนับจำนวนครั้ง
    let winCount = 0;
    let buyCount = 0;
    
    // ตัวแปรสำหรับยอดเงินทุน
    let totalInvestment = 0;    // รวมเงินลงทุน
    let investmentCount = 0;    // จำนวนครั้งที่ลงทุน
    let totalWithdrawal = 0;    // รวมเงินถอนทุน
    let withdrawalCount = 0;    // จำนวนครั้งที่ถอนทุน
    
    // ตัวแปรสำหรับยอดรวมทั้งหมด (ตั้งแต่เริ่มต้นจนถึง endDate)
    let allLotteryWin = 0;
    let allLotteryBuy = 0;
    let allInvestment = 0;
    let allWithdrawal = 0;

    // เก็บข้อมูลรายวัน
    const dailyResults = {};

    records.forEach(record => {
        if (record.account !== currentAccount) return;

        const recordDate = new Date(record.dateTime);
        const dateKey = recordDate.toLocaleDateString('th-TH');

        // สรุปยอดเฉพาะในช่วงวันที่เลือก
        if (recordDate >= startDate && recordDate <= endDate) {
            switch (record.type) {
                case "รายรับ": // เงินที่ถูกหวย
                    totalLotteryWin += record.amount;
                    winCount++;
                    
                    // บันทึกรายวัน
                    if (!dailyResults[dateKey]) {
                        dailyResults[dateKey] = { win: 0, buy: 0, investment: 0, withdrawal: 0 };
                    }
                    dailyResults[dateKey].win += record.amount;
                    break;
                    
                case "รายจ่าย": // เงินที่ซื้อหวย
                    totalLotteryBuy += record.amount;
                    buyCount++;
                    
                    // บันทึกรายวัน
                    if (!dailyResults[dateKey]) {
                        dailyResults[dateKey] = { win: 0, buy: 0, investment: 0, withdrawal: 0 };
                    }
                    dailyResults[dateKey].buy += record.amount;
                    break;
                    
                case "เพิ่มทุน":
                    totalInvestment += record.amount;
                    investmentCount++;
                    
                    // บันทึกรายวัน
                    if (!dailyResults[dateKey]) {
                        dailyResults[dateKey] = { win: 0, buy: 0, investment: 0, withdrawal: 0 };
                    }
                    dailyResults[dateKey].investment += record.amount;
                    break;
                    
                case "ถอนทุน":
                    totalWithdrawal += record.amount;
                    withdrawalCount++;
                    
                    // บันทึกรายวัน
                    if (!dailyResults[dateKey]) {
                        dailyResults[dateKey] = { win: 0, buy: 0, investment: 0, withdrawal: 0 };
                    }
                    dailyResults[dateKey].withdrawal += record.amount;
                    break;
            }
        }

        // สำหรับคำนวณยอดเงินคงเหลือ – นับทั้งหมดตั้งแต่ต้นจนถึง endDate
        if (recordDate <= endDate) {
            switch (record.type) {
                case "รายรับ":
                    allLotteryWin += record.amount;
                    break;
                case "รายจ่าย":
                    allLotteryBuy += record.amount;
                    break;
                case "เพิ่มทุน":
                    allInvestment += record.amount;
                    break;
                case "ถอนทุน":
                    allWithdrawal += record.amount;
                    break;
            }
        }
    });

    // คำนวณกำไร/ขาดทุนในช่วงวันที่เลือก (ไม่รวมเงินทุนเพิ่ม/ถอน)
    totalProfitLoss = totalLotteryWin - totalLotteryBuy;
    
    // คำนวณยอดเงินคงเหลือทั้งหมด (รวมเงินทุนเพิ่ม/ถอน)
    const accountBalance = (allInvestment + allLotteryWin) - (allWithdrawal + allLotteryBuy);
    
    // คำนวณเงินลงทุนสุทธิ
    const netInvestment = allInvestment - allWithdrawal;
    
    // คำนวณ ROI (Return on Investment)
    const netProfitLoss = accountBalance - netInvestment;
    const roiPercentage = netInvestment !== 0 ? ((netProfitLoss / netInvestment) * 100).toFixed(2) : 0;

    // สรุปผลรายวัน
    let dailySummaryHTML = '<h4 style="line-height: 0.7">สรุปรายวัน</h4><table border="1" style="width:100%; border-collapse: collapse; line-height: 0.7">';
    dailySummaryHTML += '<tr><th>วันที่</th><th>ซื้อหวย</th><th>ถูกหวย</th><th>กำไร/ขาดทุน</th></tr>';
    
    for (const [date, data] of Object.entries(dailyResults)) {
        const dailyProfitLoss = data.win - data.buy;
        dailySummaryHTML += `
            <tr style="line-height: 0.7">
                <td>${date}</td>
                <td>${data.buy.toLocaleString()} บาท</td>
                <td>${data.win.toLocaleString()} บาท</td>
                <td style="color: ${dailyProfitLoss >= 0 ? 'green' : 'red'}">
                    ${dailyProfitLoss >= 0 ? 'กำไร' : 'ขาดทุน'} ${Math.abs(dailyProfitLoss).toLocaleString()} บาท
                </td>
            </tr>
        `;
    }
    dailySummaryHTML += '</table>';

    const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
    const startDateStr = startDate.toLocaleDateString('th-TH', options);
    const endDateStr = endDate.toLocaleDateString('th-TH', options);
    const summaryTime = new Date().toLocaleString('th-TH', {
        day: '2-digit', month: '2-digit', year: 'numeric',
        hour: '2-digit', minute: '2-digit'
    }) + ' น.';

    const remark = prompt("กรุณากรอกหมายเหตุ (ถ้าไม่กรอกจะใช้ 'No comment'):", "No comment") || "No comment";
    const winPercentage = buyCount > 0 ? ((winCount / buyCount) * 100).toFixed(2) : 0;

    let resultHTML = `
        <div style="line-height: 0.7">
        <p style="line-height: 0.7">สรุปยอดบัญชี: ${currentAccount}</p>
        <p style="line-height: 0.7">สรุปเมื่อ: ${summaryTime}</p>
        <p style="line-height: 0.7">ช่วงวันที่: ${startDateStr} ถึง ${endDateStr} (${daysDiff} วัน)</p>
        <h4 style="line-height: 0.7">สรุปยอดในช่วงวันที่เลือก</h4>
        <p style="line-height: 0.7">ถูกหวย: ${totalLotteryWin.toLocaleString()} บาท (${winCount} ครั้ง)</p>
        <p style="line-height: 0.7">ซื้อหวย: ${totalLotteryBuy.toLocaleString()} บาท (${buyCount} ครั้ง)</p>
        <p style="line-height: 0.7">อัตราการถูกหวย: ${winCount}/${buyCount} ครั้ง (${winPercentage}%)</p>
        <p style="line-height: 0.7">ลงทุน: ${totalInvestment.toLocaleString()} บาท (${investmentCount} ครั้ง)</p>
        <p style="line-height: 0.7">ถอนทุน: ${totalWithdrawal.toLocaleString()} บาท (${withdrawalCount} ครั้ง)</p>
        <p style="line-height: 0.7"><strong>ยอดสุทธิในช่วงวันที่เลือก:</strong> <span style="font-size: 15px; font-weight: bold; color: ${totalProfitLoss >= 0 ? 'green' : 'red'};">${totalProfitLoss >= 0 ? 'ได้กำไร' : 'ขาดทุน'}: ${Math.abs(totalProfitLoss).toLocaleString()} บาท</span></p>
        <hr style="line-height: 0.7">
        <h4 style="line-height: 0.7">สรุปผลการลงทุนทั้งหมดถึงวันนี้</h4>
        <p style="line-height: 0.7">เงินในบัญชีถึงวันนี้เหลืออยู่: <span style="color: ${accountBalance >= 0 ? 'green' : 'red'}">${accountBalance.toLocaleString()} บาท</span></p>
        <p style="line-height: 0.7">ลงทุนช่วงเวลานี้: ${investmentCount} ครั้ง รวมลงทุนถึงช่วงเวลานี้ ${allInvestment.toLocaleString()} บาท</p>
        <p style="line-height: 0.7">ถอนทุนช่วงเวลานี้ : ${withdrawalCount} ครั้ง รวมถอนทุนช่วงเวลานี้ ${allWithdrawal.toLocaleString()} บาท</p>
        <p style="line-height: 0.7">เงินลงทุนสุทธิช่วงเวลานี้ : ${netInvestment.toLocaleString()} บาท</p>
        <p style="line-height: 0.7; font-size: 14px; font-weight: bold; color: ${netProfitLoss >= 0 ? 'green' : 'red'}">
            ลงทุนถึงวันนี้: ${netProfitLoss >= 0 ? 'กำไรสุทธิ' : 'ขาดทุนสุทธิ'} ${Math.abs(netProfitLoss).toLocaleString()} บาท (ROI: ${roiPercentage}%)
        </p>   
        <h4 style="line-height: 0.7">ผลตอบแทนการลงทุน</h4>
        <p style="line-height: 0.7">ผลตอบแทนการลงทุน: <span style="color: ${netProfitLoss >= 0 ? 'green' : 'red'}">${netProfitLoss.toLocaleString()} บาท</span></p>
        <p style="line-height: 0.7">ผลตอบแทนคิดเป็น %: <span style="color: ${roiPercentage >= 0 ? 'green' : 'red'}">${roiPercentage}%</span></p>
        <p style="line-height: 0.7">หมายเหตุ: <span style="color: orange;">${remark}</span></p>
    `;

    document.getElementById('summaryResult').innerHTML = resultHTML;
}
function summarizeToday() {
    // ตรวจสอบว่ามีข้อมูลที่จำเป็นหรือไม่
    if (!records || !currentAccount) {
        alert("ข้อมูลไม่ครบถ้วน กรุณาตรวจสอบ records และ currentAccount");
        return;
    }

    const today = new Date();
    today.setHours(0, 0, 0, 0);

    const endOfToday = new Date(today);
    endOfToday.setHours(23, 59, 59, 999);

    let totalIncomeToday = 0;
    let totalExpenseToday = 0;
    let totalIncomeAll = 0;
    let totalExpenseAll = 0;
    let totalIncrease = 0;
    let totalWithdrawal = 0;
    let incomeCountToday = 0;
    let expenseCountToday = 0;
    let increaseCount = 0;
    let withdrawalCount = 0;

    records.forEach(record => {
        // ตรวจสอบว่า record มี dateTime และเป็น string
        if (!record.dateTime || typeof record.dateTime !== 'string') return;

        const [date, time] = record.dateTime.split(" ");
        const [year, month, day] = date.split("-");
        const recordDate = new Date(year, month - 1, day);

        if (record.account === currentAccount) {
            if (recordDate >= today && recordDate <= endOfToday) {
                if (record.type === "รายรับ") {
                    totalIncomeToday += record.amount;
                    incomeCountToday++;
                }
                if (record.type === "รายจ่าย") {
                    totalExpenseToday += record.amount;
                    expenseCountToday++;
                }
            }

            if (record.type === "เพิ่มทุน") {
                totalIncrease += record.amount;
                increaseCount++;
            } else if (record.type === "ถอนทุน") {
                totalWithdrawal += record.amount;
                withdrawalCount++;
            }

            if (record.type === "รายรับ") totalIncomeAll += record.amount;
            if (record.type === "รายจ่าย") totalExpenseAll += record.amount;
        }
    });

    const netTotal = totalIncomeToday - totalExpenseToday;
    const accountBalance = totalIncrease + totalIncomeAll - totalExpenseAll - totalWithdrawal;
    
    // คำนวณผลการลงทุน
    const totalInvestment = totalIncrease - totalWithdrawal;
    const totalProfit = accountBalance - totalInvestment;
    const roiPercentage = totalInvestment > 0 ? ((totalProfit / totalInvestment) * 100).toFixed(2) : 0;

    // สรุปผลประจำวัน
    let netStatus = '';
    let remark = '';
    let netColor = 'black';

    if (totalIncomeToday === 0 && totalExpenseToday === 0) {
        netStatus = 'ไม่มีรายการ';
        remark = 'วันนี้ไม่ได้ทำรายการ';
        netColor = 'gray';
    } else {
        if (netTotal > 0) {
            netStatus = `กำไรวันนี้ ${netTotal.toLocaleString()} บาท`;
            remark = `ถูกหวยได้มากกว่าชื้อหวย ${netTotal.toLocaleString()} บาท`;
            netColor = 'green';
        } else if (netTotal < 0) {
            netStatus = `ขาดทุนวันนี้ ${Math.abs(netTotal).toLocaleString()} บาท`;
            remark = `ชื้อหวยมากกว่าถูกหวย ${Math.abs(netTotal).toLocaleString()} บาท`;
            netColor = 'red';
        } else {
            netStatus = 'เสมอตัว';
            remark = 'ชื้อหวยและถูกหวยเท่ากัน';
            netColor = 'blue';
        }
    }

    // สรุปผลการลงทุน
    let investmentStatus = '';
    let investmentColor = 'black';
    
    if (totalProfit > 0) {
        investmentStatus = `กำไรสุทธิ ${totalProfit.toLocaleString()} บาท (ROI: ${roiPercentage}%)`;
        investmentColor = 'green';
    } else if (totalProfit < 0) {
        investmentStatus = `ขาดทุนสุทธิ ${Math.abs(totalProfit).toLocaleString()} บาท (ROI: ${roiPercentage}%)`;
        investmentColor = 'red';
    } else {
        investmentStatus = 'เสมอตัว (ไม่กำไรไม่ขาดทุน)';
        investmentColor = 'blue';
    }

    const summaryDateTime = new Date().toLocaleString("th-TH", {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    }) + ' น.';

    const remarkInput = prompt("กรุณากรอกหมายเหตุ (ถ้าไม่กรอกจะใช้ 'No comment'):", "No comment") || "No comment";

    document.getElementById('summaryResult').innerHTML = `
        <p>สรุปวันนี้ : ${currentAccount}</p>
        <p>${summaryDateTime}</p>
        <p>
            ถูกหวยวันนี้ : ${totalIncomeToday.toLocaleString()} บาท 
            <span style="margin-left: 20px;">ถูก : ${incomeCountToday} รอบ</span>
        </p>
        <p>
            ชื้อหวยวันนี้ : ${totalExpenseToday.toLocaleString()} บาท 
            <span style="margin-left: 20px;">ชื้อ : ${expenseCountToday} รอบ</span>
        </p>
        <p>สรุปยอดสุทธิวันนี้ : <span style="color: ${netColor}; font-weight: bold;">${netStatus}</span></p>
        <hr>
        <p>
            <span style="color: blue;">เงินในบัญชีถึงวันนี้เหลืออยู่ :</span> 
            <span style="color: ${accountBalance >= 0 ? 'green' : 'red'};">${accountBalance.toLocaleString()}</span> บาท
        </p>
        <p>ลงทุนถึงวันนี้ : ${increaseCount} ครั้ง รวม ${totalIncrease.toLocaleString()} บาท</p>
        <p>ถอนทุนถึงวันนี้ : ${withdrawalCount} ครั้ง รวม ${totalWithdrawal.toLocaleString()} บาท</p>
        <p>เงินลงทุนสุทธิ : ${totalInvestment.toLocaleString()} บาท</p>
        <p style="margin-top: 10px;">
            <span style="font-weight: bold; color: ${investmentColor};">สรุปลงทุนถึงวันนี้ :</span> 
            <span style="color: ${investmentColor}; font-weight: bold;">${investmentStatus}</span>
        </p>
        <p style="margin-top: 10px;">
            <span style="font-weight: bold; color: ${investmentColor};">ผลตอบแทนการลงทุน :</span> 
            <span style="color: ${investmentColor}; font-weight: bold;">${totalProfit.toLocaleString()} บาท</span><br>
            <span style="font-weight: bold; color: ${investmentColor};">ผลตอบแทนคิดเป็น % :</span> 
            <span style="color: ${investmentColor}; font-weight: bold;">${roiPercentage}%</span>
        </p>
        <p>ข้อความเพิ่ม : <span style="color: orange;">${remarkInput}</span></p>
    `;
}

    // ฟังก์ชันสำหรับซ่อน/แสดงแต่ละส่วน
    function toggleSection(sectionId) {
      const section = document.getElementById(sectionId);
      section.classList.toggle('collapsed');
    }

    // ฟังก์ชันสำหรับแสดง/ซ่อนทั้งหมด
    function toggleAllSections() {
      const btn = document.querySelector('.main-toggle-btn');
      const sections = document.querySelectorAll('.section-container');
      const allHidden = Array.from(sections).every(section => section.classList.contains('collapsed'));
      
      sections.forEach(section => {
        if (allHidden) {
          section.classList.remove('collapsed');
          btn.textContent = 'ซ่อนทั้งหมด';
        } else {
          section.classList.add('collapsed');
          btn.textContent = 'แสดงทั้งหมด';
        }
      });
    }

function toggleRecordsVisibility() {
    const detailsSection = document.getElementById('detailsSection');
    if (detailsSection.style.display === 'none' || detailsSection.style.display === '') {
        detailsSection.style.display = 'block';
    } else {
        detailsSection.style.display = 'none';
    }
}

function exportToExcel() {
  if (!currentAccount) {
    alert("กรุณาเลือกบัญชีก่อนส่งออกข้อมูล");
    return;
  }

  // สร้างข้อมูลสำหรับ Excel
  let excelData = [
    ["วันที่", "เวลา", "ประเภท", "รายละเอียด", "จำนวนเงิน (บาท)", "บัญชี"]
  ];

  // เรียงลำดับข้อมูลตามวันที่ล่าสุด
  const filteredRecords = records.filter(record => record.account === currentAccount)
                               .sort((a, b) => new Date(b.dateTime) - new Date(a.dateTime));

  // เตรียมข้อมูล
  filteredRecords.forEach(record => {
    const dateTime = new Date(record.dateTime);
    const formattedDate = `${String(dateTime.getDate()).padStart(2, '0')}/${String(dateTime.getMonth() + 1).padStart(2, '0')}/${dateTime.getFullYear()}`;
    const formattedTime = `${String(dateTime.getHours()).padStart(2, '0')}.${String(dateTime.getMinutes()).padStart(2, '0')} น.`;
    
    // จัดรูปแบบตัวเลขให้มีเครื่องหมายคอมม่า
    const formattedAmount = new Intl.NumberFormat('th-TH').format(record.amount);
    
    excelData.push([
      formattedDate,
      formattedTime,
      record.type,
      record.description,
      formattedAmount,
      record.account
    ]);
  });

  // สร้างไฟล์ CSV
  let csvContent = excelData.map(row => 
    row.map(cell => `"${cell}"`).join(",")
  ).join("\r\n");

  // สร้างชื่อไฟล์
  const now = new Date();
  const dateStr = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}`;
  const timeStr = `${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}`;
  const fileName = `บัญชี_${currentAccount}_${dateStr}_${timeStr}.csv`;

  // ดาวน์โหลดไฟล์
  const blob = new Blob(["\uFEFF" + csvContent], { 
    type: "text/csv;charset=utf-8;" 
  });
  const link = document.createElement("a");
  
  link.href = URL.createObjectURL(blob);
  link.download = fileName;
  link.style.display = "none";
  
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

        function saveToFile() {
            const fileName = prompt("กรุณากรอกชื่อไฟล์ (ไม่ต้องใส่นามสกุล):");
            if (!fileName) {
                alert("กรุณากรอกชื่อไฟล์");
                return;
            }

            const now = new Date();
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = now.getFullYear();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const dateTimeString = `${day}${month}${year}_${hours}${minutes}`;

            const fullFileName = `${fileName}_${dateTimeString}.json`;

            const data = { accounts, currentAccount, records };
            const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fullFileName;
            a.click();
            URL.revokeObjectURL(url);
        }

        function loadFromFile(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            // ตรวจสอบประเภทไฟล์
            if (!file.name.endsWith('.json') && file.type !== 'application/json') {
                alert("กรุณาเลือกไฟล์ JSON เท่านั้น");
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    accounts.length = 0;
                    accounts.push(...data.accounts);
                    currentAccount = data.currentAccount;
                    records.length = 0;
                    records.push(...data.records);
                    updateAccountSelect();
                    changeAccount();
                    alert("โหลดข้อมูลสำเร็จ");
                } catch (error) {
                    alert("ไฟล์ไม่ถูกต้องหรือเสียหาย: " + error.message);
                }
            };
            reader.onerror = function() {
                alert("เกิดข้อผิดพลาดในการอ่านไฟล์");
            };
            reader.readAsText(file);
        }

        function saveToLocal() {
            const data = {
                accounts,
                currentAccount,
                records
            };
            localStorage.setItem('accountData', JSON.stringify(data));
            alert('บันทึกข้อมูลสำหรับเปิดใช้งานครั้งต่อไปเรียบร้อยแล้ว');
        }

        function loadFromLocal() {
            const data = localStorage.getItem('accountData');
            if (data) {
                try {
                    const parsed = JSON.parse(data);
                    accounts.length = 0;
                    accounts.push(...parsed.accounts || []);
                    currentAccount = parsed.currentAccount || null;
                    records.length = 0;
                    records.push(...parsed.records || []);
                    updateAccountSelect();
                    changeAccount();
                } catch (error) {
                    console.error("โหลดข้อมูลจาก LocalStorage ไม่สำเร็จ", error);
                }
            }
        }

        // เรียกใช้เมื่อเปิดหน้าเว็บ
        window.onload = function () {
            document.getElementById('detailsSection').style.display = 'none';
            loadFromLocal();
        };
    </script>
</body>
</html>
